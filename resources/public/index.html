<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">    

    <link href="css/codemirror.css" rel="stylesheet" type="text/css">
    <link href="css/codemirror-merge.css" rel="stylesheet" type="text/css">

    <link href="css/style.css" rel="stylesheet" type="text/css">


    <script src="js/codemirror.js" type="text/javascript"></script>
    <script src="js/diff_match_patch.js"></script>
    <script src="js/codemirror-merge.js" type="text/javascript"></script>

    <script src="js/javascript.js" type="text/javascript"></script>
  </head>

  <body>

    <div id="app"></div>

    <div id="editor"></div>

    <script>

      window.createEditor = function(initialKeyboardData, keyboardData) {

        var editorElement = document.getElementById("editor");

        if (keyboardData) {

          window.editor = CodeMirror.MergeView(editorElement, {
            orig: initialKeyboardData,
            value: initialKeyboardData,
            lineNumbers: true,
            mode: "application/ld+json",
            highlightDifferences: true
          });

          window.editor.editor().on("change", function(editor, change) {
            yizhackclj.db.serialization.set_keyboard_data(editor.getValue()); 
          });

          window.resizeEditor();

        } else {

          window.editor = CodeMirror(editorElement, {
            value: initialKeyboardData,
            lineNumbers: true,
            mode: "application/ld+json",
            readOnly: true
          });
        }

        editorElement.className += "hidden";
      }


      function mergeViewHeight(mergeView) {
        function editorHeight(editor) {
          if (!editor) return 0;
          return editor.getScrollInfo().height;
        }
        return Math.max(editorHeight(mergeView.leftOriginal()),
                        editorHeight(mergeView.editor()),
                        editorHeight(mergeView.rightOriginal()));
      }

      window.resizeEditor = function() {
        var mergeView = window.editor;
        var height = mergeViewHeight(mergeView);
        for(;;) {
          if (mergeView.leftOriginal())
            mergeView.leftOriginal().setSize(null, height);
          mergeView.editor().setSize(null, height);
          if (mergeView.rightOriginal())
            mergeView.rightOriginal().setSize(null, height);

          var newHeight = mergeViewHeight(mergeView);
          if (newHeight >= height) break;
          else height = newHeight;
        }
        mergeView.wrap.style.height = height + "px";
      }

    </script>

    <script src="js/compiled/yizhackclj.js" type="text/javascript"></script>
  </body>
</html>